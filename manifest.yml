info:
  name: krypton
  version: "0.1"

include:
  - file: /etc/serve/include.d/library.yml

conf:
  test-suite ? {{ vars.test-suite }}-{{ info.feature }}:
    "-": "test-master"
    "^-.+": "test"
    "*": "test-{{ vars.test-suite }}"

build:
  - docker-image: { no-push: true }
  - sh: docker run --rm {{ conf.docker.image }} make {{ conf.test-suite }}
  - sh: docker run --pull=always --rm -e MEND_URL=https://saas-eu.mend.io -e MEND_EMAIL=hesham.abdelhay@copper.co -e MEND_USER_KEY=${MEND_POC_KEY} -v "${PWD}":/home/MEND/src docker.boople.co/infra/mend-go:latest sh -c '/home/MEND/mend dep -d /home/MEND/src/ {{ conf.mend.args }} -u' || true
