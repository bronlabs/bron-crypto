\begin{protocol}[H]
    \caption{$\quad\fn{BBOT}_{\xi,\ell,\G}$}
    \label{alg:bbot}
    \begin{algorithmic}[1]
        \begin{alginfo}
            Endemically secure Batched Base ROT protocol from \cite[Figure 3]{mcquoid2021batching} and a hash function $\fn{H}$ (for two ROs $\fn{H_0}(x)$ and $\fn{H_1}(x)$), parametrized by a batch of $\xi$ messages with $\ell\by\kappa$ bits each, a group $\G$ of prime order $q$ with generator $G$.
        \end{alginfo}
        \Players a sender $\mathcal{S}$, and receiver $\mathcal{R}$.
        \Require { $\mathcal{R}\!: \vect{b} \in \Z^\xi_2$, the input choice bits. }

        \Ensure  $\mathcal{S}\leftarrow \vect{m_0}, \vect{m_1} \in \Z_2^{\xi\by\ell\by\kappa}$, two random messages.\\ 
                 $\mathcal{R}\leftarrow \vect{m_b} \in \Z_2^{\xi\by\ell\by\kappa}$, the chosen message.

        \vspace{-10pt}        
        \AlgRoundZero{\hspace{-4pt}$\mathcal{S}$}{Round1}{}{$(A)$}
        \State Sample $\sample{a}{\Z_q}$  \Commentg{$(KA.R)$}
        \State $\assign{A}{a \cdot G}$  \Commentg{$(KA.msg_1)$}
        \State $\sendTo{\mathcal{R}}{A}$

   
        \vspace{-13pt}
        \setalglineno{1}
        \AlgRound{\hspace{-4pt}$\mathcal{R}$}{Round2}{$A \ins \G, \vect{b}$}{$(\vect{m_x}, \vect{\phi})$}
        \For{$\forall i \inss \range{\xi}\;\;\forall l \inss \range{\ell}$}
            \State Sample $\sample{\beta}{\Z_q}$  \Commentg{$(KA.R)$}
            \State $\assign{m_R}{\beta \cdot G}$  \Commentg{$(KA.msg_2)$}
            \State $\assign{\vecti{m_b}{i,l}}{\fn{H}(\beta \cdot A, i \concat \vecti{b}{i})}$  \Commentg{$(KA.key_2)$}
            \State Sample $\sample{\phi_{i,l,1-\vecti{b}{i}}}{\mathbb{G}}$  \Commentg{$(POPF.Program)$}
            \State $\assign{\phi_{i,l,\vecti{b}{i}}}{m_R - \fn{H}_{\vecti{b}{i}}(\phi_{i,l,1-\vecti{b}{i}})}$  \Commentg{$(POPF.Program)$}
        \EndFor
        \State $\sendTo{\mathcal{S}}{\vect{\phi_0}\equals\{\{\phi_{i,l,0}\}_{l\in\range{\ell}}\}_{i\in\range{\xi}},\; \vect{\phi_1}\equals\{\{\phi_{i,l,1}\}_{l\in\range{\ell}}\}_{i\in\range{\xi}}}$
        \Statex \Return $(\vect{m_b}\equals\{\{\vecti{m_b}{i,l}\}_{l\in\range{\ell}}\}_{i\in\range{\xi}})$
        
        \vspace{-13pt}
        \setalglineno{1}
        \AlgRound{\hspace{-4pt}$\mathcal{S}$}{Round3}{$\vect{\phi_0}, \vect{\phi_1} \ins\G^{\xi\by\ell}$}{$\vect{m_0},\vect{m_1}$}
        \For{$\forall i \inss \range{\xi}\;\; \forall l \inss \range{\ell}\;\; \forall j \inss \{0,1\}$}
            \State $\assign{P}{\vecti{\phi_j}{i,l} + \fn{H}_j(\vecti{\phi_{1-j}}{i,l})}$  \Commentg{$(POPF.Eval)$}
            \State $\assign{\vecti{m_j}{i,l}}{\fn{H}(a \cdot P, i \concat j)}$  \Commentg{$(KA.key_1)$}
        \EndFor
        \Statex \Return $\vect{m_0}\equals\{\{\vecti{m_0}{i,l}\}_{l\in\range{\ell}}\}_{i\in\range{\xi}},\; \vect{m_1}\equals\{\{\vecti{m_1}{i,l}\}_{l\in\range{\ell}}\}_{i\in\range{\xi}}$
    \end{algorithmic}
\end{protocol}