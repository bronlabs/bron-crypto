
\begin{protocol}[H]
    \caption{$\quad$\fndef{Lindell22.Sign}}\label{alg:lindell22}
    \begin{algorithmic}[1]
        \begin{alginfo}
            An instantiation of the three-round threshold protocol of Lindell22~\cite{L22}, parametrized by a group $\G$ of prime order $q$ with generator $\g{G}$, a hash function $\fn{H}$, a \fnref[blc]{Commitment} scheme, a zero-sharing protocol \fnref{Przs} and a dlog PoK $\fnref{Fischlin}$.
        \end{alginfo}
        \Players \begin{itemize}[leftmargin=0pt,label=, itemsep=-2pt]
            \item Key share holders: $\{\party{i}\}_{i \in \range{n}}$ holding $\{x_i\}_{i \in \range{n}}$ and public key $\g{Q}$
            \item \hspace{28pt}Quorum of signers: $\{\party{i}\}_{i \in \set{S}}$ for $\set{S} \ins \subrange{t}{n}$ and $\set{S}^* \equals \set{S} \setminuss \{i\}$
        \end{itemize}
        \Require {
            $sid$: unique session id \\ 
            $m$: message to sign \\ 
            $taproot$: flag to indicate compatibility with BIP341
        }
        \vspace{-10pt}
        \AlgRoundZero{\hspace{6pt}$\party{i}$}{\fndef[lindell22]{Round1}}{}{$(c_i, \{\vecti{z^{a}}{i,j}\}_{j \in \set{S}^*})$}
            \State Sample $\sample{k_i}{\Z_{q^*}}$ and compute $\assign{R_i}{k_i \cdot G}$
            \State $\assign{(c_i,w_i)}{\fn{Commit}(R_i \concat i \concat sid \concat S)}$
            % \State Run $\assign{\{\vecti{z^{a}}{i,j}\}_{j \in \set{S}^*}}{\fnref{Przs}.\fnref[przs]{Setup1}()}$
            \State $\idealfnref{Broadcast}(c_i)$
            % \State $\sendTo{\party{j}}{\vecti{z^{a}}{i,j}}\;\;\forall j \ins \set{S}^*$

        \vspace{-10pt}
        \setalglineno{1}
        \AlgRound{\hspace{-2pt}$\party{i}$}{\fndef[lindell22]{Round2}}{$\{c_j, \vecti{z^{a}}{j,i}\}_{j \in \set{S}^*}$}{$(\pi_i^{dl}, R_i, w_i, \{\vecti{z^{b}}{i,j}\}_{j \in \set{S}^*})$}
            \State $\assign{\pi_i^{dl}}{\fnref{Fischlin}.\fnref[fischlin]{Prove}(k_i)}$
            % \State Run $\assign{\{\vecti{z^{b}}{i,j}\}_{j \in \set{S}^*}}{\fnref{Przs}.\fnref[przs]{Setup2}(\{\vecti{z^{a}}{j,i}\}_{j \in \set{S}^*})}$
            % \State $\sendTo{\party{j}}{\vecti{z^{b}}{i,j}}\;\;\forall j \ins \set{S}^*$
            \State $\idealfnref{Broadcast}(\pi_i^{dl}, R_i, w_i)$

        \vspace{-10pt}
        \setalglineno{1}
        \AlgRound{\hspace{-2pt}$\party{i}$}{\fndef[lindell22]{Round3}}{$\{\pi^{dl}_j, R_j, w_j, \vecti{z^{b}}{j,i}\}_{j \in \set{S}^*}$}{$\sigma_i$}
            \For{$j \in \set{S}^*$}
                \State Run $\fnref[blc]{Open}(R_j \concat j \concat sid \concat S, c_j, w_j)$, $\ABORT$ if it fails
                \State Run $\fnref{Fischlin}.\fnref[fischlin]{Verify}(R_j, \pi^{dl}_j)$, $\ABORT$ if it fails
            \EndFor
            \State $\assign{R}{\sum_{j\in \set{S*}}{R_j}}$
            % \State Run $\fnref{Przs}.\fnref[przs]{Setup3}(\{\vecti{z^{b}}{j,i}\}_{j \in \set{S}^*})$
            % \State Run $\assign{\zeta_i}{\fnref{Przs}.\fnref[przs]{Sample}()}$
            \State $\assign{d_i'}{\fnref{ShamirToAdditive}(i, \set{S}, x_i)}$
            \State Run $\assign{(R_i, s_i)}{\fnref{Schnorr}.\fnref[schnorr]{Variant}}(R_i, d_i')$
            % \State $\assign{s_i}{\{s'_i+\zeta_i\}}$
            \Statex \Return $\sigma_i\equals\{R_i,s_i\}$

        \vspace{-10pt}
        \setalglineno{1}
        \AlgFnct{\hspace{-2pt}\fndef[lindell22]{Aggregate}}{}{$\sigma_i \;\forall i \in \set{S}$}{$\sigma$}
            \State $r \gets \sum^n_{i=1}R_i$
            \State $s \gets \sum^n_{i=1}s_i$
            \Statex \Return $\sigma \gets \left(r, s\right)$
        
    \end{algorithmic}
\end{protocol}