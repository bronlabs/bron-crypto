\begin{protocol}[H]
    \caption{$\quad$\fn{Lindell17.DKG}}\label{alg:lindell17dkg}
    \begin{algorithmic}[1]
        \begin{alginfo}
            An adaptation of the Distributed Key Generation (DKG) of \cite[Section 3.2]{lindell17}, parametrized by a group $\G(q, \g{G})$. The protocol is symmetric for all the $n$ participants $\{\party{i}\}_{i \in \range{n}}$
        \end{alginfo} 

        \Players $\party{1}, \ldots, \party{i}, \ldots,\party{n}$.

        \vspace{-8pt}
        \AlgRound{\hspace{4pt}$\party{i}$}{Round1}{}{$\g{Q}_i^c$}
            \State Sample $\sample{x_i}{\Z_q}$ as a private key share. \Commentg{(Or reuse $x_i$ from \fn{GennaroDkg})}
            \State Sample $\sample{x_i'}{\Z_q}$ and $\sample{x_i''}{\Z_q}$ s.t. $x_i', x_i'' \in \left[\frac{q}{3}, \frac{2q}{3}\right]$ and $x_i = 3x_i' + x_i'' \mod q$ %TODO: split into steps
            \State $\assign{\g{Q}_i'}{x_i' \cdot \g{G}}$ and $\assign{\g{Q}_i''}{x_i'' \cdot \g{G}}$
            \State $\assign{(\g{Q}_i^c, \g{Q}_i^w)}{\fn{Pedersen.Commit}(\g{Q}_i', \g{Q}_i'')}$ to get a commitment to $\g{Q}_i'$ and $\g{Q}_i''$. %TODO: Describe Pedersen commitment
            \State $\idealfnref{Broadcast}(\g{Q}_i^c)$

        \vspace{-8pt}
        \setalglineno{1}
        \AlgRound{$\party{i}$}{Round2}{$\g{Q}_j^c\; \forall j \in \range{n} \setminus \{i\}$}{$\g{Q}_i^{dl'}, \g{Q}_i^{dl''}$}
            \State $\assign{\g{Q}_i^{dl'}}{(\g{Q}_i')}$ and $\assign{\g{Q}_i^{dl''}}{(\g{Q}_i'')}$ as discrete log PoKs
            \State $\idealfnref{Broadcast}(\g{Q}_i^w, \g{Q}_i', \g{Q}_i'', \g{Q}_i^{dl'}, \g{Q}_i^{dl''})$
            
        \vspace{-8pt}
        \setalglineno{1}
        \AlgRound{$\party{i}$}{Round3}{$\g{Q}_j^w, \g{Q}_j', \g{Q}_j'', \g{Q}_j^{dl'}, \g{Q}_j^{dl''}\; \forall j \in \range{n} \setminus \{i\}$}{$pk_i, c_{key_i}', c_{key_i}''$}
            \State Verify opening of $\g{Q}_i^c$
            \State Verify $\g{Q}_i^{dl'}$ and $\g{Q}_i^{dl'}$
            \State Generate Paillier key pair $(pk_i, sk_i)$
            \State $c_{key_i}' = \paillier{x_i'; r_i'}{pk_i}$ and $c_{key_i}'' = \paillier{x_i''; r_i''}{pk_i}$
            \State Start the ZK proofs process with every other $\party{j}$ (pairwise) that $pk_i$ was generated correctly ($L_P$) and that $c_{key_i}'$ and $c_{key_i}''$ encrypt dlogs of $\g{Q}_i'$ and $\g{Q}_i''$ respectively ($L_{PDL}$).
            \State $\idealfnref{Broadcast}(pk_i, c_{key_i}', c_{key_i}'')$

        \vspace{-8pt}
        \setalglineno{1}
        \AlgRound{$\party{i}$}{Round4}{$pk_j, c_{key_j}', c_{key_j}'' \forall j \in \range{n} \setminus \{i\}$}{}
            \State $c_{key_j} = 3 \odot c_{key_j}' \oplus c_{key_j}''\; \forall j \in \range{n} \setminus \{i\}$
            \State $L_P$ and $L_{PDL}$ continue

        \vspace{-8pt}
        \setalglineno{1}
        \AlgRound{$\party{i}$}{Rounds5-8}{}{}
            \State $L_P$ and $L_{PDL}$ continue. $\ABORT$ if any of the proofs fail
            \Statex \Return $(sk_i, pk_1, pk_2, ..., pk_n, c_{key_1}, c_{key_2}, ..., c_{key_n})$
    \end{algorithmic}
\end{protocol}

