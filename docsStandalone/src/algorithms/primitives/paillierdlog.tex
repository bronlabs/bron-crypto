\begin{protocol}[H]
    \caption{$\quad$\fn{Paillier \;Decryption\;is\;Discrete\;Log\;(PDL)}}\label{alg:dlog_paillier}
    \begin{algorithmic}[1]
        \begin{alginfo}
            ZKP from \cite{lindell17} that a value encrypted in a given Paillier ciphertext $c$ is the discrete log of a given Elliptic curve point $\g{Q}$.
        \end{alginfo} 
        \Players{A verifier $\mathcal{V}$, and a prover $\mathcal{P}$.}
        \Require{$\mathcal{P}, \mathcal{V} \rightarrow \pk\equiv n$, a Paillier public key; $Q$, a public point.\\
                   $\mathcal{P} \rightarrow sk \equiv \phi(n)$, the corresponding Paillier private key; $x$, a scalar.\\
                   $\mathcal{V} \rightarrow c, r$, an encrypted value of $x$, such that $c = \fn{Enc}_{\pk}(x;r)$.}
        \vspace{-13pt}

        \AlgRoundZero{\hspace{6pt}$\mathcal{V}$}{Round1}{}{$c', c''$}
            \State  Sample  $\sample{a}{\Z_q}$ and $\sample{b}{\Z_{q^2}}$
            \State Sample $r \in \Z_N^*$ verifying $\gcd(r, N)\equals 1$
            \State  $\assign{c'}{(a \odot c) \oplus \fn{Enc}_{\pk}(b; r)}$
            \State $\assign{c''}{\fn{Commit}(a, b)}$
            \State $\assign{Q'}{a \cdot Q + b \cdot G}$
            \State $\sendTo{\mathcal{P}}{c', c''}$

        \vspace{-12pt}
        \AlgRound{\hspace{-2pt}$\mathcal{P}$}{Round2}{$c', c''$}{$\hat{c}$}
            \setalglineno{1}
            \State $\assign{\alpha}{\fn{Dec}_{sk}(c')}$ and compute $\assign{\hat{Q}}{\alpha \cdot G}$
            \State $\sendTo{\mathcal{V}}{\assign{\hat{c}}{\fn{Commit}(\hat{Q})}}$

        \vspace{-12pt}
        \AlgRound{\hspace{-2pt}$\mathcal{V}$}{Round3}{$\hat{c}$}{$(a, b)$}
            \setalglineno{1}
            \State $\assign{(a, b)}{\fn{Open}(c'')}$

        \vspace{-12pt}
        \AlgRound{\hspace{-2pt}$\mathcal{P}$}{Round4}{$a, b$}{}
            \setalglineno{1}
            \State Check that $\isequal{\alpha}{a \cdot x + b}$, $\ABORT$ otherwise
            \State Run \fn{PaillierRange} proof: Prove that $x \in \Z_q$ (can be started in Round 1 and run concurrently).
            \State $\sendTo{\mathcal{V}}{\assign{\hat{Q}}{\fn{Open}(\hat{c})}}$

        \vspace{-12pt}
        \AlgRound{\hspace{-2pt}$\mathcal{V}$}{Round5}{}{\textit{valid}}
            \setalglineno{1}
            \State Check that $\isequal{\hat{Q}}{Q'}$ and that the \fn{PaillierRange} proof returns \textit{valid}. $\ABORT$ otherwise
            
    \end{algorithmic}
\end{protocol}

